{"version":3,"sources":["../../src/client/api.js"],"names":["kaelia","api","logs","level","setLevel","configure","transport","rest","window","location","origin","fetch","bind","socket","transports","path","apiPath","socketio","authentication","storage","localStorage","idField","getService","context","service","_id","users"],"mappings":";;;;;;;;;;QAQgBA,M,GAAAA,M;;AARhB;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;;;AAEO,SAASA,MAAT,GAAmB;AACxB,MAAIC,MAAM,+BAAV;AACA;AACA,MAAI,iBAAOC,IAAP,IAAe,iBAAOA,IAAP,CAAYC,KAA/B,EAAsC;AACpC,uBAAOC,QAAP,CAAgB,iBAAOF,IAAP,CAAYC,KAA5B,EAAmC,KAAnC;AACD,GAFD,MAEO;AACL,uBAAOC,QAAP,CAAgB,MAAhB;AACD;AACDH,MAAII,SAAJ,CAAc,8BAAd;AACA,MAAI,iBAAOC,SAAP,KAAqB,MAAzB,EAAiC;AAC/BL,QAAII,SAAJ,CAAc,yBAASE,IAAT,CAAcC,OAAOC,QAAP,CAAgBC,MAA9B,EAAsCC,KAAtC,CAA4CH,OAAOG,KAAP,CAAaC,IAAb,CAAkBJ,MAAlB,CAA5C,CAAd;AACD,GAFD,MAEO;AACL,QAAIK,SAAS,sBAAGL,OAAOC,QAAP,CAAgBC,MAAnB,EAA2B;AACtCI,kBAAY,CAAC,WAAD,CAD0B;AAEtCC,YAAM,iBAAOC,OAAP,GAAiB;AAFe,KAA3B,CAAb;AAIAf,QAAII,SAAJ,CAAc,yBAASY,QAAT,CAAkBJ,MAAlB,CAAd;AACD;AACDZ,MAAII,SAAJ,CAAc,yBAASa,cAAT,CAAwB;AACpCC,aAASX,OAAOY,YADoB;AAEpCL,UAAM,iBAAOC,OAAP,GAAiB;AAFa,GAAxB,CAAd;AAIAf,MAAII,SAAJ,CAAc,gDAAe;AAC3BgB,aAAS;AADkB,GAAf,CAAd;;AAIA;AACApB,MAAIqB,UAAJ,GAAiB,UAAUP,IAAV,EAAgBQ,OAAhB,EAAyB;AACxC;AACA,QAAI,OAAOA,OAAP,KAAmB,QAAvB,EAAiC;AAC/B,aAAOtB,IAAIuB,OAAJ,CAAY,iBAAOR,OAAP,GAAiB,GAAjB,GAAuBO,OAAvB,GAAiC,GAAjC,GAAuCR,IAAnD,CAAP;AACD,KAFD,MAEO,IAAI,QAAOQ,OAAP,uDAAOA,OAAP,OAAmB,QAAvB,EAAiC;AACtC,aAAOtB,IAAIuB,OAAJ,CAAY,iBAAOR,OAAP,GAAiB,GAAjB,GAAuBO,QAAQE,GAA/B,GAAqC,GAArC,GAA2CV,IAAvD,CAAP;AACD,KAFM,MAEA;AACL,aAAOd,IAAIuB,OAAJ,CAAY,iBAAOR,OAAP,GAAiB,GAAjB,GAAuBD,IAAnC,CAAP;AACD;AACF,GATD;;AAWAd,MAAIyB,KAAJ,GAAYzB,IAAIqB,UAAJ,CAAe,OAAf,CAAZ;;AAEA,SAAOrB,GAAP;AACD","file":"api.js","sourcesContent":["import logger from 'loglevel'\r\nimport feathers from 'feathers-client'\r\nimport feathersHooks from 'feathers-hooks'\r\nimport io from 'socket.io-client'\r\nimport reactive from 'feathers-reactive'\r\nimport rxjs from 'rxjs'\r\nimport config from 'config'\r\n\r\nexport function kaelia () {\r\n  let api = feathers()\r\n  // Setup log level\r\n  if (config.logs && config.logs.level) {\r\n    logger.setLevel(config.logs.level, false)\r\n  } else {\r\n    logger.setLevel('info')\r\n  }\r\n  api.configure(feathersHooks())\r\n  if (config.transport === 'http') {\r\n    api.configure(feathers.rest(window.location.origin).fetch(window.fetch.bind(window)))\r\n  } else {\r\n    let socket = io(window.location.origin, {\r\n      transports: ['websocket'],\r\n      path: config.apiPath + 'ws'\r\n    })\r\n    api.configure(feathers.socketio(socket))\r\n  }\r\n  api.configure(feathers.authentication({\r\n    storage: window.localStorage,\r\n    path: config.apiPath + '/authentication'\r\n  }))\r\n  api.configure(reactive(rxjs, {\r\n    idField: '_id'\r\n  }))\r\n\r\n  // This avoid managing the API path before each service name\r\n  api.getService = function (path, context) {\r\n    // Context is given as string ID\r\n    if (typeof context === 'string') {\r\n      return api.service(config.apiPath + '/' + context + '/' + path)\r\n    } else if (typeof context === 'object') {\r\n      return api.service(config.apiPath + '/' + context._id + '/' + path)\r\n    } else {\r\n      return api.service(config.apiPath + '/' + path)\r\n    }\r\n  }\r\n\r\n  api.users = api.getService('users')\r\n\r\n  return api\r\n}\r\n"]}